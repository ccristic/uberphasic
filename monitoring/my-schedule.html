<!DOCTYPE html>
<html>
<head>
	<title>Programul Meu</title>
	<link rel="stylesheet" type="text/css" href="../less/reset.css"/>
	<link rel="stylesheet" type="text/css" href="../less/style.css"/>
	<link rel="stylesheet" type="text/css" href="../less/typography.css"/>
	<link rel="stylesheet" type="text/css" href="../less/monitoring-my-schedule.css"/>
	<link rel="stylesheet" type="text/css" href="../less/sidebar.css"/>
	<link rel="stylesheet" type="text/css" href="../less/navbar.css"/>
	<link rel="stylesheet" href="https://unpkg.com/flatpickr/dist/flatpickr.min.css">
</head>

<body>
	<div class="sidebar">
		<a class="noselect pointer">
			<span class = "sidebar-logo">E</span>
		</a>
		<ul class="menu-icons noselect">
			<li><a href="../index.html" class="tooltip pointer">A <span class="tooltiptext">Dashboard</span></a></li>
			<li><a class="active-icon tooltip default">B <span class="tooltiptext active-tooltip">Monitorizare</span></a></li>
			<li><a href="../schedules/schedules.html" class="tooltip pointer">C <span class="tooltiptext">Sabloane</span></a></li>
			<li><a href="../theory/all-schedules.html" class="tooltip pointer">D <span class="tooltiptext">Teorie</span></a></li>
		</ul>
		<div class="dropdown noselect">
			<button class="dropbtn pointer">F</button>
			<div class="dropdown-content">
				<div class="dropdown-container">
					<a href="#">Account Settings</a>
					<a href="#" onclick="logoutUser()">Logout</a>
				</div>
			</div>
		</div>
	</div>

	<div class="wrapper">
		<div id="top-navbar">
			<ul class="navbar noselect">
				<li><a href="sleep.html">Somn</a></li>
				<li><a class="active-navbar default">Sablonul meu</a></li>
				<li><a href="history.html">Istoric</a></li>
				<li><a href="calendar.html">Calendar</a></li>		
			</ul>
		</div>
		<div id="wrapper">
			<input id="start-nap" class="flatpickr-ora" type="text" onchange="startRotateChart()">
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	
	<script type="text/javascript" src="../json/schedules.json"></script>
	<script src="https://www.gstatic.com/firebasejs/4.1.2/firebase.js"></script>
	<script src="../js/firebase-config.js"></script>
	<script src="https://unpkg.com/flatpickr"></script>

	<script type="text/javascript" src="../js/verify-connected-user.js"></script>
	<script type="text/javascript" src="../js/schedules-schedules.js"></script>

	<script>
	function startRotateChart() {
		var hour_to_minutes = moment(document.getElementById('start-nap').value, "HH:mm");
		hour_to_minutes = hour_to_minutes.hours() * 60 + hour_to_minutes.minutes();
		update(hour_to_minutes);
	}

		verifyIfConnected(app);
 				var my_schedule;
 				var myChart;
		function app() {
				firebase.database().ref('/schedule_settings/' + currentUser.uid).once('value').then(function(snapshot) {
				var schedule_settings = snapshot.val();
				console.log(schedule_settings.schedule);
				createContainer(schedule_settings.schedule);

    			my_schedule = Object.assign({}, schedules[schedule_settings.schedule]);

    			

				myChart = createChart(my_schedule, schedule_settings.schedule);

				})
 			 // ...
			};
			
			function changeScheduleFromUI() {
    			console.log(my_schedule);
    			var add_value = parseInt(document.getElementById('modify').value);
    			for (var i = 0; i < my_schedule.naps.length; i++) {
    				my_schedule.naps[i].start = parseInt(my_schedule.naps[i].start) + add_value;
    				if(my_schedule.naps[i].start > 1440)
    					my_schedule.naps[i].start -= 1440;
    				my_schedule.naps[i].stop = parseInt(my_schedule.naps[i].stop) + add_value;
    				if(my_schedule.naps[i].stop > 1440)
    					my_schedule.naps[i].start -= 1440;
    			}
    			console.log(my_schedule.title);
				var new_chart = getChartDataFromSchedule(my_schedule);
				return new_chart;
    		}
			
			function update(minutes) {
				var angle = (-0.5 * Math.PI) + ((minutes/60) * 15)/180 * Math.PI;

				myChart.options.rotation = angle;
				myChart.update();
			}
</script>
</body>
</html>